<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Heads Up</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Prevent pull-to-refresh and rubber-banding on mobile */
        body { overscroll-behavior-y: none; }
    </style>
</head>
<body class="bg-[#F2F2F7]">
    <div id="root"></div>

    <script type="text/babel">
        // --- GLOBALS (Replacing imports) ---
        const { useState, useEffect, useRef, useCallback } = React;
        const { Play, RotateCcw, Check, X, ChevronLeft, Scroll, OctagonAlert, Smartphone, Info } = lucideReact;

        // --- YOUR DATA ---
        const DECK_NOUNS = [
          "Time", "Person", "Year", "Way", "Day", "Thing", "Man", "World", "Life", "Hand",
          "Part", "Child", "Eye", "Woman", "Place", "Work", "Week", "Case", "Point", "Government",
          "Company", "Number", "Group", "Problem", "Fact", "Phone", "Pizza", "Money", "Water", "Home",
          "Room", "Mother", "Area", "Money", "Story", "Young", "Fact", "Month", "Lot", "Right",
          "Study", "Book", "Eye", "Job", "Word", "Business", "Issue", "Side", "Kind", "Head",
          "House", "Service", "Friend", "Father", "Power", "Hour", "Game", "Line", "End", "Member",
          "Law", "Car", "City", "Community", "Name", "President", "Team", "Minute", "Idea", "Kid",
          "Body", "Information", "Back", "Parent", "Face", "Others", "Level", "Office", "Door", "Health",
          "Person", "Art", "War", "History", "Party", "Result", "Change", "Morning", "Reason", "Research",
          "Girl", "Guy", "Moment", "Air", "Teacher", "Force", "Education", "Family", "Student", "System"
        ];

        const DECK_DIFFICULT = [
          "Anachronism", "Cacophony", "Ennui", "Ephemeral", "Esoteric", "Harangue", "Idiosyncratic", "Magnanimous",
          "Obfuscate", "Paradigm", "Quixotic", "Rhetoric", "Sycophant", "Ubiquitous", "Vicarious", "Zephyr",
          "Accolade", "Capricious", "Diatribe", "Equanimity", "Fastidious", "Gregarious", "Heresy", "Indelible",
          "Juxtaposition", "Lithe", "Mellifluous", "Nefarious", "Ostracize", "Panacea", "Quintessential", "Recalcitrant",
          "Scintillating", "Truculent", "Umbrage", "Vex", "Wanderlust", "Xenophobia", "Yield", "Zenith",
          "Alacrity", "Burgeon", "Deleterious", "Ebullient", "Fatuous", "Garrulous", "Hegemony", "Iconoclast"
        ];

        const DECK_BLEVNECKED = [
          "Heads up", "Chris", "Kaden", "Vienna", "Noah", "Eva", "Esmarie", "Blake", "Dahlia", "Courage",
          "Joe", "Saylor", "Jill and Reagan", "Josia", "Petrus and Lisle", "Dana and Chris", "Mackenzie",
          "Kalia", "Kyra", "Camelback inn", "Qdoba", "GCU", "Canyon Pizza Company", "Lightheart",
          "Prescott valley", "Colorado Springs", "Temecula", "Penang", "Edmond Oklahoma", "Cape Town",
          "Savvy", "Lucy", "Dana", "Liz", "Josh Sieben", "Josh Knox", "Josh Knapp", "Claire", "Ryan",
          "Jess", "Ethan", "Maddy", "Michael", "Kayleigh", "Lindsey", "Camryn", "Kamryn", "JP", "Ezra",
          "Mo", "Ollie", "Harper", "Liv", "Tatum and Moriah", "Janel", "Emily", "Soren", "Porter",
          "Cornerstone School", "Trinity Church", "Christ Church", "Open Door", "Kivi", "Wilbur", "Eben",
          "Whiskers", "Bob and Mary", "Tacoma", "Courages movie nights", "Olivas", "Lake Pleasant",
          "Cartel Coffee", "Brian and Brandi", "Nick Ely", "Sam Street", "Sandy", "Blake Brietler",
          "Ray ray", "Semih", "Mexico Trip", "Chris Renzema Concert", "Dennys", "Friendsgiving", "Joey",
          "Rachel Supergan", "KJ and Rachel", "Judah", "Connor", "Cartel Coffee Shop", "New Freedom",
          "Richie", "Grace Phillips", "Madisyn", "Miriam", "David"
        ];

        const DECKS = [
          { 
            id: 'nouns', 
            title: 'Top 100 Nouns', 
            description: 'Simple, everyday words.', 
            color: 'bg-blue-500', 
            gradient: 'from-blue-500 to-cyan-400',
            icon: <Scroll size={24} className="text-white" />,
            data: DECK_NOUNS 
          },
          { 
            id: 'blevnecked', 
            title: 'Blevnecked Related', 
            description: 'Family, Friends & Places.', 
            color: 'bg-orange-500', 
            gradient: 'from-orange-500 to-amber-400',
            icon: <span className="text-2xl">ðŸ¦…</span>, 
            data: DECK_BLEVNECKED 
          },
          { 
            id: 'difficult', 
            title: 'Difficult Deck', 
            description: 'Advanced vocabulary challenge.', 
            color: 'bg-red-600', 
            gradient: 'from-red-600 to-rose-500',
            icon: <OctagonAlert size={24} className="text-white" />,
            data: DECK_DIFFICULT 
          },
        ];

        // --- COMPONENTS ---

        function App() {
          const [view, setView] = useState('menu'); 
          const [selectedDeck, setSelectedDeck] = useState(null);
          const [shuffledCards, setShuffledCards] = useState([]);
          const [currentIndex, setCurrentIndex] = useState(0);
          const [results, setResults] = useState({ correct: [], skipped: [] });
          const [timer, setTimer] = useState(60);
          const [motionActive, setMotionActive] = useState(false);
          const [calibration, setCalibration] = useState({ beta: null, gamma: null });

          const playSound = (type) => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            const now = ctx.currentTime;
            
            if (type === 'tick') {
              osc.frequency.setValueAtTime(800, now);
              gain.gain.setValueAtTime(0.02, now);
              osc.start();
              osc.stop(now + 0.05);
            } else if (type === 'success') {
              osc.type = 'sine';
              osc.frequency.setValueAtTime(500, now);
              osc.frequency.exponentialRampToValueAtTime(1000, now + 0.1);
              gain.gain.setValueAtTime(0.15, now);
              gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
              osc.start();
              osc.stop(now + 0.3);
            } else if (type === 'pass') {
              osc.type = 'triangle';
              osc.frequency.setValueAtTime(300, now);
              osc.frequency.linearRampToValueAtTime(150, now + 0.2);
              gain.gain.setValueAtTime(0.15, now);
              gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
              osc.start();
              osc.stop(now + 0.3);
            } else if (type === 'finish') {
               osc.type = 'sine';
               osc.frequency.setValueAtTime(400, now);
               osc.frequency.exponentialRampToValueAtTime(800, now + 0.4);
               gain.gain.setValueAtTime(0.2, now);
               gain.gain.linearRampToValueAtTime(0, now + 0.8);
               osc.start();
               osc.stop(now + 0.8);
            }
          };

          const selectDeck = (deck) => {
            setSelectedDeck(deck);
            const shuffled = [...deck.data].sort(() => 0.5 - Math.random());
            setShuffledCards(shuffled);
            setCurrentIndex(0);
            setResults({ correct: [], skipped: [] });
            setTimer(60);
            setView('instructions'); 
          };

          const finishGame = useCallback(() => {
            playSound('finish');
            setView('results');
          }, []);

          return (
            <div className="fixed inset-0 bg-[#F2F2F7] overflow-hidden touch-none select-none font-sans text-slate-900">
              {view === 'menu' && (
                <MenuView decks={DECKS} onSelect={selectDeck} />
              )}

              {view === 'instructions' && (
                <InstructionsView 
                    deck={selectedDeck}
                    onStart={(granted) => {
                        setMotionActive(granted);
                        setView('countdown');
                    }}
                />
              )}
              
              {view === 'countdown' && (
                <CountdownView 
                  onFinished={(cal) => {
                    setCalibration(cal);
                    setView('game');
                  }} 
                  motionActive={motionActive}
                />
              )}

              {view === 'game' && (
                <GameView 
                  deck={selectedDeck}
                  cards={shuffledCards}
                  currentIndex={currentIndex}
                  setCurrentIndex={setCurrentIndex}
                  timer={timer}
                  setTimer={setTimer}
                  results={results}
                  setResults={setResults}
                  onFinish={finishGame}
                  playSound={playSound}
                  motionActive={motionActive}
                  calibration={calibration}
                />
              )}

              {view === 'results' && (
                <ResultsView 
                  results={results} 
                  deck={selectedDeck}
                  onHome={() => setView('menu')}
                  onRestart={() => selectDeck(selectedDeck)}
                />
              )}
            </div>
          );
        }

        function MenuView({ decks, onSelect }) {
          return (
            <div className="flex flex-col h-full safe-area-inset-bottom max-w-md mx-auto w-full bg-[#F2F2F7]">
              <div className="flex-none px-6 pt-12 pb-6">
                <h1 className="text-3xl font-bold tracking-tight text-slate-900">
                  Heads Up
                </h1>
                <h2 className="text-3xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 -mt-1">
                  Blevnecked
                </h2>
                <p className="text-slate-500 mt-2 text-base font-medium">Choose a deck to play.</p>
              </div>
              
              <div className="flex-1 overflow-y-auto px-6 pb-8 space-y-4">
                {decks.map((deck) => (
                  <button 
                    key={deck.id}
                    onClick={() => onSelect(deck)}
                    className="w-full bg-white p-4 rounded-2xl shadow-[0_2px_8px_rgba(0,0,0,0.04)] active:scale-[0.98] transition-all duration-200 flex items-center justify-between border border-white/50 group"
                  >
                    <div className="flex items-center space-x-4">
                       <div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${deck.gradient} flex items-center justify-center shadow-sm`}>
                          {deck.icon}
                       </div>
                       <div className="text-left">
                          <h3 className="text-lg font-semibold text-slate-900 leading-tight">{deck.title}</h3>
                          <p className="text-sm text-slate-500 leading-tight mt-0.5">{deck.description}</p>
                       </div>
                    </div>
                    <div className="flex flex-col items-end justify-center">
                         <span className="text-xs font-bold text-slate-400 mb-1">{deck.data.length} Cards</span>
                         <div className="w-8 h-8 rounded-full bg-slate-100 text-slate-400 group-hover:bg-slate-200 group-hover:text-slate-600 transition-colors flex items-center justify-center">
                            <Play size={14} fill="currentColor" />
                         </div>
                    </div>
                  </button>
                ))}
              </div>
              <div className="p-6 text-center text-slate-400 text-xs font-medium">
                 <div className="flex items-center justify-center gap-2 mb-1">
                   <Smartphone size={16}/>
                 </div>
                 <p>Works best on mobile. Tap deck to begin.</p>
              </div>
            </div>
          );
        }

        function InstructionsView({ deck, onStart }) {
            const handleStart = async () => {
                if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    try {
                        const response = await DeviceOrientationEvent.requestPermission();
                        if (response === 'granted') {
                            onStart(true);
                        } else {
                            alert("Motion permission was denied. Tap fallback controls will be used.");
                            onStart(false);
                        }
                    } catch (error) {
                        alert("Motion error: " + error.message + ". Make sure you are on HTTPS.");
                        onStart(false);
                    }
                } else {
                    onStart(true);
                }
            };

            return (
                <div className="fixed inset-0 z-50 bg-white/95 backdrop-blur-xl flex flex-col items-center justify-center p-8 text-center animate-in fade-in duration-300">
                    <div className="max-w-xs w-full">
                        <div className={`w-20 h-20 mx-auto rounded-3xl bg-gradient-to-br ${deck.gradient} flex items-center justify-center shadow-lg mb-6`}>
                            {deck.icon}
                        </div>
                        <h2 className="text-2xl font-bold text-slate-900 mb-2">Ready to Play?</h2>
                        <p className="text-slate-500 mb-8 leading-relaxed">
                            1. Tap Start.<br/>
                            2. Allow "Motion" access.<br/>
                            3. Place phone on forehead.<br/>
                            4. Tilt <b>Down</b> for correct, <b>Up</b> to pass.
                        </p>
                        <button 
                            onClick={handleStart}
                            className="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-200 transition-transform active:scale-95 text-lg"
                        >
                            Start Game
                        </button>
                        <p className="mt-6 text-[10px] text-slate-400 uppercase tracking-widest font-bold">
                            Requires iOS Motion Permission
                        </p>
                    </div>
                </div>
            );
        }

        function CountdownView({ onFinished, motionActive }) {
          const [count, setCount] = useState(3);
          const [isPortrait, setIsPortrait] = useState(false);
          const calibrationRef = useRef({ beta: 0, gamma: 0 });

          useEffect(() => {
            const checkOrientation = () => setIsPortrait(window.innerHeight > window.innerWidth);
            checkOrientation();
            window.addEventListener('resize', checkOrientation);

            const handleCalibration = (e) => {
                if (e.beta !== null && e.gamma !== null) {
                    calibrationRef.current = { beta: e.beta, gamma: e.gamma };
                }
            };
            
            if (motionActive) {
                window.addEventListener('deviceorientation', handleCalibration);
            }

            if (count > 0) {
              const timer = setTimeout(() => setCount(count - 1), 1000);
              return () => { 
                clearTimeout(timer); 
                window.removeEventListener('resize', checkOrientation);
                window.removeEventListener('deviceorientation', handleCalibration);
              };
            } else {
              window.removeEventListener('deviceorientation', handleCalibration);
              onFinished(calibrationRef.current);
            }
          }, [count, onFinished, motionActive]);

          const rotateStyle = isPortrait ? { transform: 'rotate(90deg)' } : {};

          return (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900 text-white transition-all duration-500">
              <div style={rotateStyle} className="flex flex-col items-center transition-transform duration-500">
                <div className="text-[8rem] font-bold leading-none tracking-tighter animate-pulse text-white">
                    {count > 0 ? count : "GO!"}
                </div>
                <p className="mt-8 text-white/50 font-medium text-xl uppercase tracking-widest text-center px-8">
                    Place on Forehead
                </p>
              </div>
            </div>
          );
        }

        function GameView({ deck, cards, currentIndex, setCurrentIndex, timer, setTimer, setResults, onFinish, playSound, motionActive, calibration }) {
          const [status, setStatus] = useState('active'); 
          const [isPortrait, setIsPortrait] = useState(false);
          
          useEffect(() => {
            const checkOrientation = () => setIsPortrait(window.innerHeight > window.innerWidth);
            checkOrientation();
            window.addEventListener('resize', checkOrientation);
            return () => window.removeEventListener('resize', checkOrientation);
          }, []);

          useEffect(() => {
            if (timer <= 0) {
              onFinish();
              return;
            }
            const interval = setInterval(() => {
              setTimer((t) => t - 1);
              if (timer <= 5) playSound('tick');
            }, 1000);
            return () => clearInterval(interval);
          }, [timer, onFinish, playSound]);

          const handlePass = useCallback(() => {
            if (status !== 'active') return;
            setStatus('pass');
            playSound('pass');
            setResults(prev => ({ ...prev, skipped: [...prev.skipped, cards[currentIndex]] }));
            setTimeout(() => {
              if (currentIndex < cards.length - 1) {
                setCurrentIndex(c => c + 1);
                setStatus('active');
              } else {
                onFinish();
              }
            }, 600);
          }, [status, cards, currentIndex, setResults, setCurrentIndex, onFinish, playSound]);

          const handleCorrect = useCallback(() => {
            if (status !== 'active') return;
            setStatus('correct');
            playSound('success');
            setResults(prev => ({ ...prev, correct: [...prev.correct, cards[currentIndex]] }));
            setTimeout(() => {
              if (currentIndex < cards.length - 1) {
                setCurrentIndex(c => c + 1);
                setStatus('active');
              } else {
                onFinish();
              }
            }, 600);
          }, [status, cards, currentIndex, setResults, setCurrentIndex, onFinish, playSound]);

          // --- TILT LOGIC (DeviceOrientation) ---
          useEffect(() => {
            if (!motionActive) return;
            
            let debounce = false;
            
            const handleOrientation = (event) => {
              if (status !== 'active' || debounce) return;

              const { beta, gamma } = event;
              if (beta === null || gamma === null) return;
              
              const deltaBeta = beta - calibration.beta;
              const deltaGamma = gamma - calibration.gamma;
              const THRESHOLD = 35; 

              if (Math.abs(deltaGamma) > THRESHOLD) {
                 if (deltaGamma > THRESHOLD) { 
                     debounce = true; handleCorrect(); setTimeout(() => { debounce = false; }, 1000);
                 } else if (deltaGamma < -THRESHOLD) { 
                     debounce = true; handlePass(); setTimeout(() => { debounce = false; }, 1000);
                 }
              } 
              else if (Math.abs(deltaBeta) > THRESHOLD) {
                if (deltaBeta < -THRESHOLD) { 
                     debounce = true; handleCorrect(); setTimeout(() => { debounce = false; }, 1000);
                } else if (deltaBeta > THRESHOLD) { 
                     debounce = true; handlePass(); setTimeout(() => { debounce = false; }, 1000);
                }
              }
            };

            window.addEventListener('deviceorientation', handleOrientation);
            return () => window.removeEventListener('deviceorientation', handleOrientation);
          }, [motionActive, status, handleCorrect, handlePass, calibration]);

          let bgClass = "bg-slate-900";
          let cardClass = "opacity-100 scale-100 translate-y-0";
          
          if (status === 'correct') {
            bgClass = "bg-[#34C759]";
            cardClass = "opacity-0 translate-y-[120%] rotate-6";
          } else if (status === 'pass') {
            bgClass = "bg-[#FF9500]";
            cardClass = "opacity-0 translate-y-[-120%] -rotate-6";
          }

          const containerStyle = isPortrait 
            ? { 
                transform: 'rotate(90deg)', 
                transformOrigin: 'center center',
                width: '100vh', height: '100vw',
                position: 'absolute', top: '50%', left: '50%',
                marginLeft: '-50vh', marginTop: '-50vw',
              } 
            : { width: '100%', height: '100%' };

          return (
            <div className={`fixed inset-0 z-50 flex flex-col transition-colors duration-500 ease-out ${bgClass} overflow-hidden`}>
              <div style={containerStyle} className="relative flex flex-col w-full h-full">
                <div className="absolute top-0 left-0 w-full p-6 flex justify-between items-center z-10 text-white/90">
                  <div className="flex items-center space-x-3 bg-white/10 backdrop-blur-md px-4 py-1.5 rounded-full border border-white/10">
                    <span className="font-mono text-lg font-bold tracking-wider">{timer}</span>
                  </div>
                  <div className="font-semibold text-sm opacity-80 uppercase tracking-widest flex items-center gap-2">
                    {deck.title}
                  </div>
                </div>

                <div className="flex-1 flex items-center justify-center p-8 relative">
                  <div className={`transform transition-all duration-500 ease-out ${cardClass} w-full max-w-3xl aspect-[2/1] bg-white rounded-[2.5rem] shadow-2xl flex items-center justify-center p-8 text-center relative`}>
                      {status === 'active' ? (
                          <div className="flex flex-col items-center justify-center h-full w-full">
                              <h2 className="text-6xl md:text-8xl font-bold tracking-tight text-slate-900 leading-none break-words max-w-full">
                                  {cards[currentIndex]}
                              </h2>
                              <p className="absolute bottom-8 text-slate-300 text-xs font-bold uppercase tracking-widest">
                                  Tilt Down Correct â€¢ Tilt Up Pass
                              </p>
                          </div>
                      ) : <div />}
                      {status === 'active' && (
                        <>
                          <div onClick={handlePass} className="absolute inset-y-0 left-0 w-24 z-20" />
                          <div onClick={handleCorrect} className="absolute inset-y-0 right-0 w-24 z-20" />
                        </>
                      )}
                  </div>
                </div>
                
                <div className="absolute inset-0 flex items-center justify-center pointer-events-none z-0">
                  {status === 'correct' && <Check size={180} className="text-white/25 animate-ping duration-700" />}
                  {status === 'pass' && <RotateCcw size={180} className="text-white/25 animate-ping duration-700" />}
                </div>
              </div>
            </div>
          );
        }

        function ResultsView({ results, deck, onHome, onRestart }) {
          return (
            <div className="h-full w-full flex flex-col bg-[#F2F2F7] safe-area-inset-bottom">
              <div className="flex-none px-6 py-6 bg-white border-b border-slate-200 shadow-sm z-10 flex justify-between items-center sticky top-0">
                <div>
                   <h2 className="text-2xl font-bold text-slate-900">Game Over</h2>
                   <p className="text-slate-500 text-sm font-medium">{deck.title}</p>
                </div>
                <div className="text-right">
                   <span className="block text-3xl font-bold text-[#34C759] leading-none">{results.correct.length}</span>
                   <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Correct</span>
                </div>
              </div>

              <div className="flex-1 overflow-y-auto p-4 space-y-3">
                {results.correct.map((word, i) => (
                  <div key={`c-${i}`} className="flex items-center px-4 py-3 bg-white rounded-xl shadow-sm border border-slate-100">
                    <div className="w-8 h-8 rounded-full bg-[#34C759]/10 flex items-center justify-center text-[#34C759] mr-3 flex-shrink-0">
                      <Check size={14} strokeWidth={3} />
                    </div>
                    <span className="text-lg font-semibold text-slate-900">{word}</span>
                  </div>
                ))}
                {results.skipped.map((word, i) => (
                  <div key={`s-${i}`} className="flex items-center px-4 py-3 bg-white/60 rounded-xl border border-slate-100/50">
                     <div className="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-400 mr-3 flex-shrink-0">
                      <X size={14} strokeWidth={3} />
                    </div>
                    <span className="text-lg font-medium text-slate-400 line-through decoration-slate-300">{word}</span>
                  </div>
                ))}
                {results.correct.length === 0 && results.skipped.length === 0 && (
                  <div className="text-center py-10 text-slate-400">No cards played.</div>
                )}
              </div>

              <div className="flex-none p-6 bg-white border-t border-slate-200 grid grid-cols-2 gap-4 pb-10">
                <button onClick={onHome} className="flex items-center justify-center px-6 py-3.5 rounded-xl bg-slate-100 text-slate-900 font-semibold text-base active:bg-slate-200 transition-colors">
                  <ChevronLeft className="mr-2" size={18} /> Menu
                </button>
                <button onClick={onRestart} className="flex items-center justify-center px-6 py-3.5 rounded-xl bg-slate-900 text-white font-semibold text-base shadow-lg active:scale-95 transition-transform">
                  Play Again
                </button>
              </div>
            </div>
          );
        }

        // --- RENDER ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
